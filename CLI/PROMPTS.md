# Prompt Templates

> How prompts are generated and structured for each AI role.
> For orchestrator flow, see [ORCHESTRATOR.md](./ORCHESTRATOR.md)

---

## Overview

Prompts are generated by the **orchestrator** model, not hardcoded. This allows:

- Context-aware prompt generation
- Adaptation to project-specific needs
- Learning from previous interactions

However, all prompts MUST include certain **mandatory rules**.

---

## Mandatory Rules (All Prompts)

Every prompt sent to any LLM MUST include:

```markdown
## CRITICAL RULES

1. **NEVER touch .steroids/ directory**
   - Do NOT read, write, or modify any files in .steroids/
   - This includes all .json, .yaml, and .yml files
   - You MAY read .md files in .steroids/ for context only

2. **Use CLI for all task operations**
   All task status changes MUST go through the steroids CLI:
   - `steroids tasks update <id> --status <status>`
   - `steroids tasks approve <id>`
   - `steroids tasks reject <id>`
   - `steroids dispute create <id>`

3. **Never modify TODO.md checkboxes directly**
   - Use the CLI to change task status
   - The CLI will update the markdown

4. **Follow project guidelines**
   - Respect AGENTS.md constraints
   - Follow coding standards in CLAUDE.md
   - Adhere to file size limits (500 lines max)
```

---

## Prompt Structure

### Common Template

```markdown
# Task: {task_title}

## Context

**Task ID:** {task_id}
**Status:** {current_status}
**Project:** {project_name}
**Source Specification:** {source_file_link}

## Project Guidelines

{agents_md_content}

## Your Role

{role_specific_instructions}

## Task Details

{task_description_from_source_file}

## Relevant Files

{list_of_related_files}

## Critical Rules

{mandatory_rules}

## Expected Output

{what_you_expect_them_to_produce}
```

---

## Coder Prompts

### Starting a New Task

```markdown
# Task: Implement user authentication

## Context

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Status:** pending → in_progress
**Project:** my-webapp
**Source Specification:** docs/SPEC.md#authentication

## Project Guidelines

{contents of AGENTS.md}

## Your Role

You are the CODER. Your job is to implement this task according to the specification.

## Task Details

From docs/SPEC.md#authentication:
{extracted specification content}

## Relevant Files

- src/auth/ (directory - may need to create)
- src/middleware/auth.ts (exists - may need to modify)
- tests/auth/ (directory - add tests here)

## Critical Rules

1. NEVER touch .steroids/ directory
2. Use CLI for all task operations
3. Never modify TODO.md checkboxes directly
4. Follow project guidelines

## Expected Output

1. Implement the authentication feature as specified
2. Add appropriate tests
3. When complete, run:
   `steroids tasks update a1b2c3d4-... --status review`

## Getting Started

First, read the full specification at docs/SPEC.md#authentication.
Then implement the feature step by step.
```

### Resuming an In-Progress Task

```markdown
# Task: Implement user authentication (RESUMING)

## Context

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Status:** in_progress (resuming after interruption)
**Project:** my-webapp

## Previous State

This task was started but interrupted. You may find partial work in:
- src/auth/login.ts (partially implemented)
- src/auth/session.ts (partially implemented)

## Your Role

Continue from where the previous coder left off. Review the existing
changes, complete the implementation, and submit for review.

## When Complete

Run: `steroids tasks update a1b2c3d4-... --status review`
```

### Fixing After Rejection

```markdown
# Task: Implement user authentication (FIX REQUIRED)

## Context

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Status:** rejected → in_progress
**Project:** my-webapp

## Reviewer Feedback

The reviewer rejected your previous implementation with these notes:

> "Missing input validation on login form. Also, session timeout is
> not configurable as specified in the requirements."

## Your Role

Address the reviewer's feedback:
1. Add input validation to login form
2. Make session timeout configurable
3. Verify against specification again

## When Complete

Run: `steroids tasks update a1b2c3d4-... --status review`
```

---

## Reviewer Prompts

### Reviewing a Task

```markdown
# Review: Implement user authentication

## Context

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Status:** review (submitted by coder)
**Project:** my-webapp
**Source Specification:** docs/SPEC.md#authentication

## Your Role

You are the REVIEWER. Your job is to verify the implementation matches
the specification and follows project guidelines.

## Original Specification

From docs/SPEC.md#authentication:
{extracted specification content}

## Changes Made

```diff
{git diff of changes made by coder}
```

## Files Modified

- src/auth/login.ts (new)
- src/auth/session.ts (new)
- src/middleware/auth.ts (modified)
- tests/auth/login.test.ts (new)

## Review Checklist

1. Does the implementation match the specification?
2. Are there any bugs or security issues?
3. Are tests adequate and passing?
4. Does it follow AGENTS.md guidelines?
5. Is the code under 500 lines per file?

## Your Decision

After review, choose ONE:

**APPROVE** (implementation is correct):
```bash
steroids tasks approve a1b2c3d4-... --model {your_model}
```

**REJECT** (needs changes):
```bash
steroids tasks reject a1b2c3d4-... --model {your_model} --notes "Reason for rejection"
```

**DISPUTE** (fundamental disagreement):
```bash
steroids dispute create a1b2c3d4-... --reason "Architecture disagreement"
```

## Critical Rules

1. NEVER touch .steroids/ directory
2. Use CLI for all decisions
3. Be specific in rejection notes
4. Only dispute for fundamental issues (not style preferences)
```

---

## Orchestrator Prompts

The orchestrator generates prompts for coder and reviewer. Here's how:

### Generating Coder Prompt

```markdown
# Generate Coder Prompt

## Task Information

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Title:** Implement user authentication
**Source File:** docs/SPEC.md#authentication
**Status:** pending → in_progress

## Project Context

**AGENTS.md:**
{agents_md_content}

**Related Files:**
- src/auth/ (directory)
- src/middleware/auth.ts

## Your Job

Generate a complete prompt for the CODER model to implement this task.
Include:
1. Clear instructions on what to build
2. Reference to specification
3. List of relevant files
4. The mandatory rules (no touching .steroids/, use CLI, etc.)
5. Expected deliverables

Output the prompt in markdown format.
```

### Generating Reviewer Prompt

```markdown
# Generate Reviewer Prompt

## Task Information

**Task ID:** a1b2c3d4-e5f6-7890-abcd-ef1234567890
**Title:** Implement user authentication
**Source File:** docs/SPEC.md#authentication
**Status:** review

## Changes to Review

```diff
{git diff}
```

## Your Job

Generate a complete prompt for the REVIEWER model to review this task.
Include:
1. The original specification
2. What changes were made
3. Specific things to verify
4. How to approve/reject/dispute
5. The mandatory rules

Output the prompt in markdown format.
```

---

## Prompt Variables

| Variable | Source | Description |
|----------|--------|-------------|
| `{task_id}` | tasks.json | Unique task identifier |
| `{task_title}` | TODO.md | Task title text |
| `{task_description}` | sourceFile | Full task specification |
| `{current_status}` | tasks.json | pending/in_progress/review/completed |
| `{project_name}` | Current directory | Project folder name |
| `{source_file_link}` | Task metadata | Link to specification |
| `{agents_md_content}` | AGENTS.md | Project guidelines |
| `{git_diff}` | `git diff` | Changes made by coder |
| `{reviewer_notes}` | Rejection data | Why task was rejected |

---

## Prompt Best Practices

### Do

- Be specific about expectations
- Include all relevant context
- Reference specific files and line numbers
- Set clear success criteria
- Include the mandatory rules verbatim

### Don't

- Leave ambiguous instructions
- Assume LLM remembers previous context
- Skip the mandatory rules
- Include sensitive credentials
- Reference .steroids/ internals

---

## Related Documentation

- [ORCHESTRATOR.md](./ORCHESTRATOR.md) - How prompts are used
- [AI-PROVIDERS.md](./AI-PROVIDERS.md) - Provider configuration
- [AUDIT.md](./AUDIT.md) - Tracking who did what
